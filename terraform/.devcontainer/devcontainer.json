// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/ubuntu
{
  "name": "Development Workspace",
  // Optionally consider using a prebuilt container image via
  // devcontainer or via a standard docker image
  // Pulled images speed up loading times instead of waiting for builds
  "image": "docker.io/k8smaestro/devcontainer-iaac:1.1",

  // Docker Run Args
  "runArgs": ["--shm-size=256m", "--tmpfs", "/tmp:rw,noexec,nosuid,size=5g"],

  // "build": {
  //     "dockerfile": "Dockerfile",
  //     "args": {
  //         "VARIANT": "ubuntu-22.04"
  //     }
  // },

  // Custom volumes and mounts to persist and share information
  "mounts": [
      // Windows SSH_AUTH_SOCK setup issue revert to static SSH files
      "source=${localEnv:HOME}${localEnv:USERPROFILE}/.ssh,target=/home/vscode/.dev-host-ssh,type=bind,consistency=cached"
  ],

  // https://code.visualstudio.com/remote/advancedcontainers/environment-variables
  "remoteEnv": {},

  "containerEnv": {},

  // The more features added the longer container takes to build
  // Features to add to the dev container. More info: https://containers.dev/features.
  "features": {
    // Terraform Versions https://github.com/hashicorp/terraform/releases
    // Terragrunt Versions https://github.com/gruntwork-io/terragrunt/releases
    "ghcr.io/devcontainers/features/terraform:1": { "version": "1.3.9", "terragrunt": "0.44.5"},
    // Kubernetes Versions https://kubernetes.io/releases/
    // Helm Version Skew for kubectl n-3 https://helm.sh/docs/topics/version_skew/
    "ghcr.io/devcontainers/features/docker-in-docker:2": {},
    "ghcr.io/devcontainers/features/kubectl-helm-minikube:1": {"version": "1.24.10", "helm": "3.11.1", "minikube": "latest"},
    "ghcr.io/dhoeric/features/hadolint:1": {},
    "ghcr.io/dhoeric/features/terraform-docs:1": {},
    "ghcr.io/dhoeric/features/tfsec:1": {},
    "ghcr.io/dhoeric/features/trivy:1": {},
    "ghcr.io/lukewiwa/features/shellcheck:0": {},
    "ghcr.io/devcontainers-contrib/features/zsh-plugins:0": {
      "plugins": "git zsh-autosuggestions zsh-syntax-highlighting kubectl",
      "omzPlugins": "https://github.com/zsh-users/zsh-autosuggestions https://github.com/zsh-users/zsh-syntax-highlighting.git"
    }
  },

  // Configure tool-specific properties.
  "customizations": {
      "vscode": {
        "settings": {
          "dev.containers.copyGitConfig": true,
          "files.eol": "\n",
          "terminal.integrated.scrollback": 100000,
          "terminal.integrated.profiles.linux": {
            "zsh": {
              "path": "/usr/bin/zsh"
            }
          },
          "terminal.integrated.defaultProfile.linux": "zsh"
        },
        "extensions": [
          "streetsidesoftware.code-spell-checker",
          "hashicorp.hcl",
          "hashicorp.terraform",
          "timonwong.shellcheck",
          "davidanson.vscode-markdownlint",
          "dbaeumer.vscode-eslint",
          "esbenp.prettier-vscode",
          "redhat.Ansible",
          "golang.go",
          "ms-python.python",
          "github.vscode-github-actions",
          "donjayamanne.githistory"
        ]
      }
  },

  // Use 'forwardPorts' to make a list of ports inside the container available locally.
  // "forwardPorts": [],

  // Use ' initializeCommand'to run commands on the host machine before the container is created
  // "initializeCommand": [],

  // Use 'postCreateCommand' to run commands after the container is created.
  // git exited with 128: fatal: detected dubious ownership in repository
  // "postCreateCommand": "sudo git config --system --add safe.directory \"*\"",

  // Uncomment to connect as root instead. More info: https://aka.ms/dev-containers-non-root.
  "remoteUser": "vscode"
}
